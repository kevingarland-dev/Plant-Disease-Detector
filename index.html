<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PlantSense.AI | Disease Detection</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
  <div class="container">
    <h1>üåø PlantSense.AI</h1>
    <p class="subtitle">Smart plant disease analysis powered by AI üåé</p>

    <div class="file-input">
      <input type="file" id="imageInput" accept="image/*">
    </div>

    <img id="preview" src="" alt="Image preview" style="display: none;">
    <button onclick="predict()">üîç Analyze Plant Health</button>

    <!-- üîÑ Loading Spinner -->
    <div id="loading" style="display: none; text-align: center;">
      <div class="spinner"></div>
      <p>Analyzing your plant image...</p>
    </div>

    <div id="result"></div>
    <footer>¬© 2025 PlantSense.AI | Empowering Farmers with Intelligence</footer>
  </div>

  <!-- üéôÔ∏è Voice Assistant Button -->
  <button id="voiceAssistantBtn" onclick="toggleVoiceAssistant()" title="Talk to PlantSense AI">üéôÔ∏è</button>

  <!-- üß† Voice Assistant Popup -->
  <div id="voiceAssistantPopup" class="voice-popup">
    <div class="voice-header">
      <span>üéß PlantSense AI Voice Assistant</span>
      <button class="close-btn" onclick="toggleVoiceAssistant()">√ó</button>
    </div>
    <div class="voice-body">
      <div class="listening-indicator">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <p id="voice-status">Listening...</p>
    </div>
    <div class="voice-footer">
      <button class="stop-btn" onclick="stopVoiceAgent()">üõë Stop</button>
    </div>
  </div>

  <script>
  const API_URL = "https://plant-disease-detector-1-9brt.onrender.com/predict"; // Change when deploying

  document.getElementById("imageInput").onchange = function (event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        const preview = document.getElementById("preview");
        preview.src = reader.result;
        preview.style.display = "block";
      };
      reader.readAsDataURL(file);
    }
  };

  async function predict() {
    const file = document.getElementById("imageInput").files[0];
    const loadingDiv = document.getElementById("loading");
    const resultDiv = document.getElementById("result");

    if (!file) return alert("Please select an image first!");

    const formData = new FormData();
    formData.append("file", file);

    // Show loading spinner
    loadingDiv.style.display = "block";
    resultDiv.innerHTML = "";

    try {
      const response = await fetch(API_URL, {
        method: "POST",
        body: formData,
        mode: "cors",
      });

      if (!response.ok) {
        const text = await response.text();
        throw new Error(`HTTP ${response.status}: ${text}`);
      }

      const result = await response.json();

      // Hide loading spinner
      loadingDiv.style.display = "none";

      const diseaseName = result.disease || result.class || "Unknown Disease";
      const description = result.description || result.nlp_description || "No description available.";

      let html = `
        <div class="prediction-header">
          ‚úÖ Detected Disease: <strong>${diseaseName}</strong><br>
        </div>
        <div class="symptoms-section">
          <div class="section-title">DESCRIPTION</div>
          <div class="symptom-item">${description}</div>
        </div>
      `;
      resultDiv.innerHTML = html;

    } catch (err) {
      loadingDiv.style.display = "none";
      resultDiv.innerHTML = `
        <div class="error">
          ‚ùå ${err.message}<br><br>
          Ensure the API is running and accessible at:<br>${API_URL}
        </div>`;
    }
  }

  function toggleVoiceAssistant() {
    const popup = document.getElementById("voiceAssistantPopup");
    popup.style.display = popup.style.display === "flex" ? "none" : "flex";
  }

  function stopVoiceAgent() {
    document.getElementById("voice-status").textContent = "Stopped.";
  }
  </script>
</body>
</html>
